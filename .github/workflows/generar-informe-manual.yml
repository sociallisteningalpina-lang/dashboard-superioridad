# Nombre del workflow que aparecer√° en la pesta√±a "Actions"
name: 'Generar Informe Manualmente'

on:
  workflow_dispatch:

jobs:
  generate-report-only:
    runs-on: ubuntu-latest

    # --- A√ëADIDO: Permisos para que el robot pueda hacer 'git push' ---
    permissions:
      contents: write

    steps:
      # Paso 1: Descarga una copia de tu repositorio
      - name: 1. Descargar el c√≥digo del repositorio
        uses: actions/checkout@v4

      # Paso 2: Configura el entorno de Python
      - name: 2. Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      # Paso 3: Instala las librer√≠as necesarias
      - name: 3. Instalar las librer√≠as necesarias
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # Paso 4 (DEBUG - Opcional, pero √∫til): Verifica que el Excel es el correcto
      - name: 'DEBUG: Verificar qu√© archivos y commits ve el robot'
        run: |
          echo "--- 1. Mostrando el commit que se est√° usando ---"
          git log -n 1
          echo "--- 2. Listando los archivos descargados ---"
          ls -lR
          echo "--- 3. Leyendo las √∫ltimas filas del Excel con Python ---"
          python -c "import pandas as pd; df = pd.read_excel('Comentarios Campa√±a.xlsx'); print('El archivo tiene', len(df), 'filas en total.'); print('--- MOSTRANDO LAS √öLTIMAS 10 FILAS ---'); print(df.tail(10))"

      # Paso 5: Ejecuta tu script para generar el nuevo index.html
      - name: 5. Ejecutar S√ìLO la generaci√≥n del informe
        run: python generar_informe.py

      # --- A√ëADIDO: ¬°Este es el paso clave que faltaba! ---
      # Paso 6: Sube el nuevo index.html al repositorio
      - name: 6. Subir los archivos actualizados al repositorio
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add index.html
          # Revisa si hay cambios para "commitear", y si los hay, los sube.
          git diff-index --quiet HEAD || git commit -m "üìä Actualizaci√≥n manual del informe"
          git push
